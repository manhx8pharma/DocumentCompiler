# DocCompile - Document Generation System

## Overview

DocCompile is a comprehensive document management and generation system built with React and Node.js. The system enables users to create document templates, manage template fields, and generate documents either individually or in bulk batches. It provides a complete workflow for document creation from template upload to final document generation with support for Microsoft Word documents and Excel batch processing.

## System Architecture

### Frontend Architecture
- **React 18** with TypeScript for type safety
- **Vite** for fast development and optimized builds
- **Tailwind CSS** with shadcn/ui components for consistent styling
- **TanStack Query** for server state management and caching
- **Wouter** as lightweight router for client-side navigation
- **React Hook Form** with Zod validation for form handling

### Backend Architecture
- **Node.js** with Express.js server framework
- **TypeScript** throughout the codebase for type safety
- **Drizzle ORM** for database operations with PostgreSQL
- **Multer** for file upload handling
- **Docxtemplater** for Word document processing and template manipulation
- **JSZip** and **Mammoth** for additional document processing capabilities

### Database Design
- **PostgreSQL** as primary database with UUID-based primary keys
- **Drizzle ORM** for type-safe database operations
- Tables: templates, templateFields, documents, documentFields, batchSessions, batchDocuments, batchDocumentFields
- Enum types for categories and document statuses

## Key Components

### Template Management
- **Template Upload**: Supports .docx and .doc file formats
- **Field Analysis**: Automatically extracts placeholder fields from templates using `{{fieldName}}` syntax
- **Category System**: Organizes templates by category (legal, financial, hr, marketing, etc.)
- **Preview Generation**: Converts templates to HTML for preview functionality
- **Excel Export**: Generates Excel templates for batch data entry

### Document Generation
- **Individual Creation**: Single document generation with real-time preview
- **Batch Processing**: Excel-based bulk document creation with approval workflow
- **Template Processing**: Uses docxtemplater for placeholder replacement
- **File Management**: Organized storage system with UUID-based file naming

### Batch Processing System
- **Excel Import**: Parses Excel files for batch document creation
- **Session Management**: Tracks batch processing sessions with approval states
- **Document Status**: Individual document approval/rejection within batches
- **Bulk Operations**: Mass approval, rejection, and export functionality

## Data Flow

### Template Upload Flow
1. User uploads Word document via frontend
2. Backend validates file format and size
3. Template analyzer extracts placeholder fields
4. Template and fields saved to database
5. File stored in organized directory structure

### Document Creation Flow
1. User selects template and fills form fields
2. Real-time preview generated using template processor
3. Document generated by replacing template placeholders
4. Final document saved and made available for download

### Batch Processing Flow
1. User uploads Excel file with multiple rows of data
2. System creates batch session and parses Excel data
3. Each row becomes a batch document with approval status
4. User reviews and approves/rejects individual documents
5. Approved documents generated and packaged for download

## External Dependencies

### Core Dependencies
- **@tanstack/react-query**: Server state management
- **drizzle-orm**: Database ORM and query builder
- **docxtemplater**: Word document template processing
- **multer**: File upload middleware
- **mammoth**: Document to HTML conversion
- **xlsx**: Excel file processing
- **archiver**: ZIP file creation for batch downloads

### UI Dependencies
- **@radix-ui**: Accessible UI primitives
- **tailwindcss**: Utility-first CSS framework
- **lucide-react**: Icon library
- **react-hook-form**: Form handling
- **wouter**: Lightweight routing

## Deployment Strategy

### Environment Configuration
- **PostgreSQL** database connection via DATABASE_URL
- **Session management** with configurable session secret
- **File storage** in local storage directory with configurable paths
- **Port configuration** defaulting to 5000

### Build Process
- **Frontend**: Vite builds React app to static files
- **Backend**: esbuild bundles Node.js server for production
- **Database**: Drizzle migrations for schema management

### Replit Integration
- **Auto-scaling deployment** target configured
- **PostgreSQL module** provisioned automatically
- **Development workflow** with hot reloading enabled

## Changelog

- June 16, 2025. Initial setup
- June 16, 2025. Added bulk download functionality with ZIP file generation, organized by template folders
- June 16, 2025. Fixed file path synchronization issue between database and file system storage
- June 17, 2025. Optimized document preview with A4 responsive layout (210:297 aspect ratio)
- June 17, 2025. Synchronized document preview styling between create and update pages with consistent A4 layout and scroll bars
- June 17, 2025. Added "Hide Document Preview" toggle button in document-create for improved data entry speed
- June 24, 2025. Implemented multiline field support with dynamic textarea/input toggle buttons
- June 24, 2025. Added field type override system allowing users to switch between single-line and multiline input per field
- June 24, 2025. Added document search functionality by name with search input in documents window header
- June 24, 2025. Enhanced search algorithm with multi-field search, word-based matching, and relevance scoring
- June 24, 2025. Fixed search algorithm to properly prioritize exact phrase matches over word-based matching
- June 24, 2025. Fixed preview rendering issues: preserved line breaks in field values and maintained original document text alignment from templates
- June 24, 2025. Fixed document creation API to accept both fields array and fieldValues object formats from frontend
- June 24, 2025. Updated docxtemplater API calls to use render() instead of deprecated setData() method
- June 24, 2025. Fixed file path synchronization issues for HĐLĐ documents (rolled back complex integrity checking to maintain functionality)

## User Preferences

Preferred communication style: Simple, everyday language.